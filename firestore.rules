service cloud.firestore {
  match /databases/{database}/documents {
    function isAuth() {
    		return (request.auth.uid != null)
    }
    
    match /households/{householdId} {
      allow read: if isAuth();

			allow create: if isAuth()
      							&& request.resource.data.keys().hasAll(["users"])
                
			allow update: if isAuth()
          					&& (
                    	(request.resource.data.keys().hasAll(["users"])
                		|| resource.data.users[request.auth.uid].role == "admin"))
    }
    
    match /users/{userId} {
      allow write: if isAuth()
      allow read: if isAuth()

			allow create: if isAuth() && (
      					!request.resource.data.keys().hasAll(["households"])
                || request.resource.data.households.id is string)
	  }
  }
}